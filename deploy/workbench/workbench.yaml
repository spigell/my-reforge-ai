---
apiVersion: v1
kind: Pod
metadata:
  labels:
    app: my-reforge-ai
  name: my-reforge-ai-workbench
  namespace: my-reforge-ai
spec:
  automountServiceAccountToken: false
  containers:
    - command:
        - /bin/bash
        - -c
        - /project/deploy/workbench/user-bootstrap.sh codex
      image: ghcr.io/spigell/codex-workbench:v0.46.0-5fc8ea
      name: codex-workbench
      resources:
        limits:
          cpu: '2'
          memory: 2Gi
        requests:
          cpu: '0.2'
          memory: 1Gi
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          add:
            - CHOWN
            - FOWNER
            - SETGID
            - SETFCAP
            - SETUID
            - DAC_OVERRIDE
          drop:
            - ALL
        seccompProfile:
          type: RuntimeDefault
      volumeMounts:
        - mountPath: /home/spigell/.codex
          name: codex
        - mountPath: /project
          name: project
        - mountPath: /tmp
          name: tmp
      workingDir: /project
    - command:
        - /bin/bash
        - -c
        - /project/deploy/workbench/user-bootstrap.sh gemini
      image: ghcr.io/spigell/google-gemini-workbench:0.9.0-5d94ed
      name: gemini-workbench
      resources:
        limits:
          cpu: '2'
          memory: 2Gi
        requests:
          cpu: '0.2'
          memory: 1Gi
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          add:
            - CHOWN
            - FOWNER
            - SETGID
            - SETFCAP
            - SETUID
            - DAC_OVERRIDE
          drop:
            - ALL
        seccompProfile:
          type: RuntimeDefault
      volumeMounts:
        - mountPath: /home/spigell/.gemini
          name: gemini
        - mountPath: /project
          name: project
        - mountPath: /tmp
          name: tmp
      workingDir: /project
  enableServiceLinks: false
  hostUsers: true
  terminationGracePeriodSeconds: 4
  volumes:
    - name: project
      nfs:
        path: /home/spigell/projects/my-ai-improvements
        server: 192.168.1.48
    - name: codex
      persistentVolumeClaim:
        claimName: codex-home
    - name: gemini
      persistentVolumeClaim:
        claimName: gemini-home
    - emptyDir: {}
      name: tmp
